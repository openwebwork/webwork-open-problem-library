# Problem from Business Calculus with Excel, Mike May, Anneke Bart
# WeBWorK problem written by Mike May, <mike.may@slu.edu>

## Author('Megan Nigg, Mike May');
## DBsubject(Algebra)
## DBchapter(Systems of equations and inequalities )
## DBsection(Linear systems)
## Institution(Saint Louis University)
## Level(2)
## MO(1)
## TitleText1('Business Calculus with Excel')
## AuthorText1('May')
## Chapter('2')
## Section('1').
## Problem('11')
## KEYWORDS('algebra','linear','systems', 'regression')

DOCUMENT();

loadMacros(
"PGstandard.pl",
"MathObjects.pl",
"PGcourse.pl",
"parserPopUp.pl",
"contextInequalities.pl",
"PGessaymacros.pl",
);

TEXT(beginproblem());

Context("Vector");
Context()->variables->add(q=>'Real');
################################################
#   Base values
for($i=0; $i<6; $i++)
{
$q[$i]=500+$i*100+random(-20,20,2);
$sp[$i]=300+40*$i;
$dp[$i]=700-60*$i;
$sp[$i]=random(0.9*$sp[$i], 1.1*$sp[$i],0.01);
$dp[$i]=random(0.9*$dp[$i], 1.1*$dp[$i],0.01);
}
$q[6]=random(730,770,10);
#################################################
#  Set-up
#Demand price equation
{
$x[0] = $q[1];
$x[1] = $q[2];
$x[2] = $q[3];
$x[3] = $q[5];
$y[0] = $dp[1];
$y[1] = $dp[2];
$y[2] = $dp[3];
$y[3] = $dp[5];
}

$sx =0;
$sy =0;
$sxy =0;
$sx2 =0;
$sy2 =0;
$meanx =0;
$meany =0;

for($i=0; $i<4; $i++) {
	$sx = $sx + $x[$i];
	$sy = $sy + $y[$i];
	$sxy = $sxy + ($x[$i]*$y[$i]);
	$sx2 = $sx2 + ($x[$i]**2);
	$sy2 = $sy2 + ($y[$i]**2);
	$meanx = $meanx+$x[$i];
	$meany = $meany+$y[$i];
}

$meanx = $meanx/4;
$meany = $meany/4;
$ssxy = $sxy-(($sx*$sy)/4);
$ssx = $sx2-(($sx**2)/4);
$ssy = $sy2-(($sy**2)/4);

$r = $ssxy/sqrt($ssx*$ssy);
$dpm = $ssxy/$ssx;
$dpb = $meany-$dpm*$meanx;
$dpf =Formula("$dpm*q+$dpb");

#################################################
#Supply price equation
{
$x[0] = $q[0];
$x[1] = $q[2];
$x[2] = $q[4];
$x[3] = $q[5];
$y[0] = $sp[0];
$y[1] = $sp[2];
$y[2] = $sp[4];
$y[3] = $sp[5];
}

$sx =0;
$sy =0;
$sxy =0;
$sx2 =0;
$sy2 =0;
$meanx =0;
$meany =0;

for($i=0; $i<4; $i++) {
	$sx = $sx + $x[$i];
	$sy = $sy + $y[$i];
	$sxy = $sxy + ($x[$i]*$y[$i]);
	$sx2 = $sx2 + ($x[$i]**2);
	$sy2 = $sy2 + ($y[$i]**2);
	$meanx = $meanx+$x[$i];
	$meany = $meany+$y[$i];
}

$meanx = $meanx/4;
$meany = $meany/4;
$ssxy = $sxy-(($sx*$sy)/4);
$ssx = $sx2-(($sx**2)/4);
$ssy = $sy2-(($sy**2)/4);

$r = $ssxy/sqrt($ssx*$ssy);
$spm = $ssxy/$ssx;
$spb = $meany-$spm*$meanx;
$spf =Formula("$spm*q+$spb");

#################################################
#Add in computed values

for($i=0; $i<7; $i++) {
$cdp[$i]=$dpf->eval(q=>$q[$i]);
$csp[$i]=$spf->eval(q=>$q[$i]);
}
##################################


$qeq = Compute("($dpb-$spb)/($spm-$dpm)");
$peq=$spf->eval(q=>$qeq);

Context()->texStrings;
BEGIN_TEXT

Given 
$BR
$BCENTER
\{ 
begintable(5) .
row( "quantity", "$q[0]","$q[1]","$q[2]","$q[3]","$q[4]","$q[5]","$q[6]") .
row( "Supply Price", "$sp[0]","","$sp[2]","","$sp[4]","$sp[5]","") .
row( "Demand Price","","$dp[1]","$dp[2]","$dp[3]","","$dp[5]",,"") .
endtable(); 
\}
$ECENTER
a. Find equations of the supply and demand curves, assuming they are both linear (use \(q\) in place of quantity).
$BR
supply= \{ans_rule\}
$BR
demand=\{ans_rule\}
$BR
$BR
b. Find the market equilibrium.
$BR
quantity= \{ans_rule\}
$BR
$BR
c. Find the projected supply and demand prices for the extra quantities given.
\{ 
begintable(5) .
row( "quantity", "$q[0]","$q[1]","$q[2]","$q[3]","$q[4]","$q[5]","$q[6]") .
row( "Supply Price", "$sp[0]",ans_rule(5),"$sp[2]",ans_rule(5),"$sp[4]","$sp[5]",ans_rule(5)) .
row( "Demand Price",ans_rule(5),"$dp[1]","$dp[2]","$dp[3]",ans_rule(5),"$dp[5]",ans_rule(5)) .
endtable(); 
\}

END_TEXT
Context()->normalStrings;

$showPartialCorrectAnswers = 1;

ANS( $spf->cmp() );
ANS( $dpf->cmp() );
ANS( $qeq->cmp() );
ANS( $csp[1]->cmp() );
ANS( $csp[3]->cmp() );
ANS( $csp[6]->cmp() );
ANS( $cdp[0]->cmp() );
ANS( $cdp[4]->cmp() );
ANS( $cdp[6]->cmp() );


Context()->texStrings;
BEGIN_SOLUTION
${PAR}SOLUTION:${PAR}

a. For this problem the trendlines are truly models and will find the best fit curve.
$BR
To be able to use Goal Seek we do need a table generated by formulas, so we use the trendline equations:
$BR
$BCENTER
\(supplyPrice=$spf\)
$BR
\(demandPrice=$dpf\)
$ECENTER
$BR
b. The market equilibrium takes place at \(q=$qeq\) with a price of $\($peq\)
$BR
$BR
c. The projected prices are
$BR
\{ 
begintable(5) .
row( "quantity", "$q[0]","$q[1]","$q[2]","$q[3]","$q[4]","$q[5]","$q[6]") .
row( "Supply Price", "$csp[0]","$csp[1]","$csp[2]","$csp[3]","$csp[4]","$csp[5]","$csp[6]") .
row( "Demand Price","$cdp[0]","$cdp[1]","$cdp[2]","$cdp[3]","$cdp[4]","$cdp[5]","$cdp[6]") .
endtable(); 
\}

END_SOLUTION
Context()->normalStrings;

COMMENT('MathObject version.');

ENDDOCUMENT();       
