##DESCRIPTION
##
## Created by the UBC Faculty of Applied Science.  
## Project led by Agnes d'Entremont, Jonathan Verrett, and Negar M. Harandi, 
## with support from Paul Lucina and Joseph Yan.
##              
## Contact: agnes.dentremont@mech.ubc.ca
##
## This work is licensed under the Creative Commons
## Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)
## <https://creativecommons.org/licenses/by-sa/4.0/>
##
## We gratefully acknowledge the financial support for this
## project provided by UBC Vancouver students via the Teaching
## and Learning Enhancement Fund. We also gratefully acknowledge
## additional funding support from the UBC Department of
## Electrical Engineering, and the UBC Applied Science Dean’s Office.  
##
## This work was completed on the traditional, ancestral, and unceded
## territory of the Musqueam people.
##
##ENDDESCRIPTION

## DBsubject(Engineering Signals and Systems)
## DBchapter()
## DBsection()
## Date()
## Author()
## Level()
## KEYWORDS('')
## RESOURCES('UBC-SIG-18-054.png')
## Institution('University of British Columbia')
## TitleText('TBD')
## EditionText('TBD')
## AuthorText('TBD')
## Section('TBD')
## Problem('TBD')
##############################################################

DOCUMENT();

#image scale
$imgScale = .18;

#image aspect ratio
$width = $imgScale*1892;
$height = $imgScale*1279;

loadMacros(   
	"PGstandard.pl",     # Standard macros for PG language
	"MathObjects.pl",
	"PGML.pl",
	"parserPopUp.pl",
	"parserMultiAnswer.pl",
	"parserRadioButtons.pl",
	"parserFunction.pl"
	#"source.pl",        # allows code to be displayed on certain sites.
	#"PGcourse.pl", 	 # Customization file for the course
   	);

TEXT(beginproblem());

##############################################################
#
#  Setup
#
#

Context("Matrix");
Context()->variables->add(s=>"Real");

#given
$r = random(2, 6, 1);
$l = random(0.2, 0.9, 0.1);
$k = random(0.01, 0.07, 0.01);
$j = random(0.01, 0.07, 0.01);
$a = random(0.1, 0.7, 0.1);
$b = $a;

$mcYes = PopUp(["?","Yes","No"], "Yes");

#computation 
$ansA = Formula("$k/(($j s + $b)($l s + $r)+$k^2)");

$ansBA = Matrix("[[-$b/$j,$k/$j],[-$k/$l,-$r/$l]]");
$ansBB = Matrix("[[0],[1/$l]]");
$ansBC = Matrix("[[1,0]]");
$ansBD = Matrix("[[0]]");

$ansC = Matrix("[[1,0],[-$b/$j, $k/$j]]");

##############################################################
#
#  Text 
#
#

BEGIN_PGML

Enter your matrices with nested square brackets or you will receive an error message (e.g., \[\[a,b\],\[c,d\]\] to represent [`\begin{bmatrix}a \hspace{0.1in} b \\c \hspace{0.1in} d\end{bmatrix}`] or \[\[a\],\[b\]\] to represent [`\begin{bmatrix}a \\b \end{bmatrix}`])

The diagram below shows the equivalent circuit of a DC motor and a free-body diagram of the rotor. Assume that the input of the system is the voltage source ([`v`]), that is applied to the motorÃ¢ÂÂs armature. The output of the system is the rotational speed of the system, [`\dot{\theta}`].  

[@ image("UBC-SIG-18-054.png", width=>[$width], height=>[$height], tex_size=>500) @]*

In this example, assume that the torque, [`T`], that is generated by the DC motor is proportional to the current flowing through the motor with a constant [`K`], i.e [`T=ki`]. The back-emf is proportional to the angular velocity of the shaft by the same constant [`K`], i.e [`e = K\dot{\theta}`]. Furthermore, assume a viscous friction model, meaning that the friction torque is proportional to shaft angular velocity, so [`F_f = b\dot{\theta}`].

The physical parameters for this example are: 
	[`\cdot`] Rotor's moment of inertia, [`J=[$j]`] [`kg\cdot m^2`]  
	[`\cdot`] Motor's constant of friction, [`b = [$a]`] [`N\cdot m\cdot s`]  
	[`\cdot`] Motor's torque constant, [`K=[$k]`] [`\frac{N\cdot m}{Amp}`]  
	[`\cdot`] Electric resistance, [`R = [$r]`] [`\Omega`]  
	[`\cdot`] Electric inductance, [`L = [$l]`] [`H`]  

*a)* Use Newton's 2nd law and Kirchhoff's voltage rule to write the two equations for the system and find the transfer function of the system and find the transfer function, [`G(s)=\frac{\dot{\theta}(s)}{V(s)}`].

[`G(s)=`] [___________________]

*b)* Find the equivalent state-space model for this system, using the state vector [`s(t) = \begin{bmatrix}\dot{\theta}(t)\\i(t)\end{bmatrix}`] and enter each of the [`[A,B,C,D]`] matrices below. 

[`A=`] [___________________]

[`B=`] [___________________]

[`C=`] [___________________]

[`D=`] [___________________]

*c)* Find the observability matrix [`M_o`] of the system and enter it below. 

[`M_o=`] [___________________]

*d)* Is the system observable? [@ $mcYes->menu() @]*

_Part *d* will only be marked correct if part *c* is correct._

END_PGML

ANS($ansA->cmp);

ANS($ansBA->cmp);
ANS($ansBB->cmp);
ANS($ansBC->cmp);
ANS($ansBD->cmp);

ANS($ansC->cmp);

$ans_hash6 = $ansC->cmp->evaluate($inputs_ref->{ANS_NUM_TO_NAME(6)});
$cCorrect= $ans_hash6->{score};

ANS($mcYes->cmp(checker=>sub{
		my ($correct,$student) = @_; 
		if (($student == $correct)&& $cCorrect==1) {
			return 1;
		}else {
			return 0;
		}	
	}));


##############################################################

ENDDOCUMENT();