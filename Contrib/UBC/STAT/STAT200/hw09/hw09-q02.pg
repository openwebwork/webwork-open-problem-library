##DESCRIPTION
##  Statistics problem: confidence intervals
##ENDDESCRIPTION

##KEYWORDS('statistics', 'statistical inference', 'hypothesis test', 'p-value', 'interpretatin')

## DBsubject('Statistics')
## DBchapter('Statistical Inference')
## DBsection('Hypothesis test')
## Level(5)
## Date('10/24/2012')
## Author('Djun Kim')
## Institution('UBC')


########################################################################

DOCUMENT();      

loadMacros(
   "PGstandard.pl",     # Standard macros for PG language
   "MathObjects.pl",
   "PGchoicemacros.pl",
   "parserMultiAnswer.pl",
);

# Print problem number and point value (weight) for the problem
TEXT(beginproblem());

# Show which answers are correct and which ones are incorrect
$showPartialCorrectAnswers = 0;

##############################################################
#
#  Setup
#
#
Context("Numeric");


$nconven = random(75, 79, 1);
$nconv_d = $nconven/100;

$nnew = random(81, 85, 1);
$nnew_d = $nnew/100;


######################################################
# Part 1
$mc1_answer      = "\(H_0: p_C - p_N = 0\)  and  \(H_A: p_C - p_N \ne 0\)";

$mc1_distractor1 = "\(H_0: p_C - p_N = 0\)  and  \(H_A: p_C - p_N > 0\)";
$mc1_distractor2 = "\(H_0: p_C - p_N = 0\)  and  \(H_A: p_C - p_N < 0\)";
$mc1_distractor3 = "\(H_0: p_N = $nconv_d \)  and  \(H_A: p_N \ne $nconv_d \)";

$mc1 = new_multiple_choice ();
$mc1->qa(
    "What are the appropriate null and alternative hypotheses?",
    $mc1_answer
);

$mc1->extra(
    $mc1_distractor1,
    $mc1_distractor2,
    $mc1_distractor3,
);


######################################################
# Part 2
$mc2_answer = "The probability of committing the Type I error is 10$PERCENT.";

$mc2_distractor1 = "There is 10$PERCENT chance to reject the null hypothesis.";

$mc2_distractor2 = "The Type II error is 90$PERCENT.";

$mc2_distractor3 = "There is 10$PERCENT chance that the null hypothesis is true.";

$mc2_distractor4 = "The Type I error is 10$PERCENT.";

$mc2_distractor5 = "The probability of committing the Type II error is 90$PERCENT.";

$mc2 = new_checkbox_multiple_choice();

$mc2 -> qa (
"The committee decides to perform the hypothesis test at 10$PERCENT significance level. Which of the following is/are true? (Check all that apply.)", 
   $mc2_answer,
);
$mc2 -> extra(
   $mc2_distractor1,
   $mc2_distractor2,
   $mc2_distractor3,
   $mc2_distractor4,
   $mc2_distractor5,
);
$mc2->makeLast("None of the above.");

######################################################
#Part 3

$mc3_answer1 = "The two random samples are no larger than 10$PERCENT of their respective population sizes.";

$mc3_answer2 = "The two random samples of students are independent.";

$mc3_distractor1 = "The variable whether a student passes or not follows the Normal model.";

$mc3_distractor2 = "The population sizes are sufficiently large.";

$mc3 = new_checkbox_multiple_choice();

$mc3 -> qa (
"Which of the following assumptions and conditions are needed to carry out the hypothesis test? CHECK ALL THAT APPLY.", 
   $mc3_answer1,
   $mc3_answer2,
);
$mc3 -> extra(
   $mc3_distractor1,
   $mc3_distractor2,
);
$mc3->makeLast("None of the above.");

######################################################
# Part 4

$c1 = $nconv_d - $nnew_d;

$c2 =  -$c1;
$s =  sqrt( $nconv_d*(1-$nconv_d)/100 + $nnew_d*(1-$nnew_d)/100 );
$r1 = 1.96 * $s;
$r2 = 2.00 * $s;

$a1 = $c1 - $r1;
$b1 = $c1 + $r1;

$a2 = $c1 - $r2;
$b2 = $c1 + $r2;

$a3 = $c2 - $r1;
$b3 = $c2 + $r1;

$a4 = $c2 - $r2;
$b4 = $c2 + $r2;


$multians = MultiAnswer($a2, $b2)->with(
  singleResult => 1,
  checker => sub {
      my ( $correct, $student, $self ) = @_;
      my ( $a_stu, $b_stu ) = @{$student};
      my ( $f1, $f2 ) = @{$correct};
      if (
           (abs($a_stu - $a1) < 0.001 && abs($b_stu - $b1) < 0.001 )  ||
           (abs($a_stu - $a2) < 0.001 && abs($b_stu - $b2) < 0.001 ) ||
           (abs($a_stu - $a3) < 0.001 && abs($b_stu - $b3) < 0.001 ) ||
           (abs($a_stu - $a4) < 0.001 && abs($b_stu - $b4) < 0.001 )
          )
      {
         return [1,1];
      }
      else {
         return [0,0];  
      }

  }
);



##############################################################
#
#  Text
#
#

Context()->texStrings;
BEGIN_TEXT
Smart Driver Driving School has many branches across provinces. In a province different from the one in problem 1, the teaching committee at the provincial branch randomly assigned half of their 5000 students enrolled this year to receive the conventional teaching method and the remaining half to receive the new teaching method. In a random sample of 100 students who received the conventional teaching method, $nconven passed the road test. In another random sample of 100 students who received the new teaching method, $nnew passed the road test. The committee would like to use the sample data to test if the two teaching methods have different passing rates. Let \(p_C\) and \(p_N\) be the true passing rates of the conventional and the new teaching methods, respectively.

$PAR

$BBOLD Part i) $EBOLD
\{ $mc1->print_q() \}
$BR
\{ $mc1->print_a() \}

$PAR
$BBOLD Part ii) $EBOLD
\{ $mc2->print_q() \}
$BR
\{ $mc2->print_a() \}

$PAR
$BBOLD Part iii) $EBOLD
\{ $mc3->print_q() \}
$BR
\{ $mc3->print_a() \}

$PAR
$BBOLD Part iv) $EBOLD
Construct a 95$PERCENT confidence interval for the difference in the true passing rates (expressed as proportions) between the conventional and new teaching methods: 

$PAR
95$PERCENT confidence interval: ( \{ $multians->ans_rule(6) \},\{ $multians->ans_rule(6)\}) [Your two numbers must be rounded to 3 decimal places. Keep at least 6 significant figures in intermediate steps.]


END_TEXT

Context()->normalStrings;

##############################################################
#
#  Answers
#
#


ANS( radio_cmp( $mc1->correct_ans() ) );
ANS( checkbox_cmp( $mc2->correct_ans() ) );
ANS( checkbox_cmp( $mc3->correct_ans() ) );
ANS( $multians->cmp() ); 



Context()->normalStrings;

COMMENT('MathObject version.');

ENDDOCUMENT(); 