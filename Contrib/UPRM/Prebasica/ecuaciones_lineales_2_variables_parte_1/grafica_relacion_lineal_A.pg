#  DESCRIPTION
#
#  Tipo: seleccion multiple
#  Problema que pregunta a los estudiantes
#  elegir la gráfica de una recta dada entre 4 opciones
#
#  Problema WebWork escrito por Edwin Florez, 
#  <edwin.florez (at) upr (dot) edu>
#
#  Adaptado desde el sistema quiz.uprm.edu del archivo 
#  pedro_prebasica/ecuaciones_lineales_2_variables_parte_1/grafica_relacion_lineal.db
#
#  ENDDESCRIPTION

## DBsubject(Prebasica)
## DBchapter(Ecuaciones lineales)
## DBsection(Forma y=mx+b)
## Level(1)
## KEYWORDS('grafica', 'lineal','interceptos','pendiente')
## Author(Edwin Florez)
## Institution(UPRM)
## Language(es)

DOCUMENT();

loadMacros(
"PGstandard.pl",
"PGchoicemacros.pl",
"MathObjects.pl",
"PGgraphmacros.pl",
"unionTables.pl",
"parserPopUp.pl",
"problemRandomize.pl"
);

TEXT(beginproblem());
$refreshCachedImages = 1;

#  Allow for the user to try another version of the problem once they get it correct.
ProblemRandomize(when=>"Correct",onlyAfterDue=>0);

# Show which answers are correct and which ones are incorrect
$showPartialCorrectAnswers = 0;


$m = random(-3,3,1);
$b = random(-9,9,1);

$f[0] = "$m*x + $b for x in <-10,10> using color:red and weight:2";
$gr[0] = init_graph(-10,-10,10,10,axes=>[0,0],grid=>[10,10],ticks=>[20,20]);
#$gr[0]->lb('reset');
#$gr[0]->lb(new Label(9.5,0.4,'x','black','center','middle'));
#$gr[0]->lb(new Label(0.4,9.5,'y','black','center','middle'));

$f[1] = "$m*x - $b for x in <-10,10> using color:red and weight:2";
$gr[1] = init_graph(-10,-10,10,10,axes=>[0,0],grid=>[10,10],ticks=>[20,20]);
#$gr[1]->lb('reset');
#$gr[1]->lb(new Label(9.5,0.4,'x','black','center','middle'));
#$gr[1]->lb(new Label(0.4,9.5,'y','black','center','middle'));

$f[2] = "- $m*x + $b for x in <-10,10> using color:red and weight:2";
$gr[2] = init_graph(-10,-10,10,10,axes=>[0,0],grid=>[10,10],ticks=>[20,20]);
#$gr[2]->lb('reset');
#$gr[2]->lb(new Label(9.5,0.4,'x','black','center','middle'));
#$gr[2]->lb(new Label(0.4,9.5,'y','black','center','middle'));

$f[3] = "- $m*x - $b for x in <-10,10> using color:red and weight:2";
$gr[3] = init_graph(-10,-10,10,10,axes=>[0,0],grid=>[10,10],ticks=>[20,20]);
#$gr[3]->lb('reset');
#$gr[3]->lb(new Label(9.5,0.4,'x','black','center','middle'));
#$gr[3]->lb(new Label(0.4,9.5,'y','black','center','middle'));

for $i (0..3) {
  plot_functions( $gr[$i], $f[$i]);
  $fig[$i]=image( insertGraph($gr[$i]),width=>200,height=>200,tex_size=>450 );
}

@eqn =(  "$m x + $b",   "$m x - $b",
                 "- $m x + $b", "- $m x - $b"  );  #Arreglo de posibles rectas a preguntar

$k = random(0,3,1);      #Indice aleatorio de la recta a preguntar 

@perm = shuffle(4);     
@fig = @fig[@perm];     #Barajando las figuras a dibujar
@inv = invert(@perm);  #Recuperando el arreglo original para hacer un pareo con la contestación del arreglo @letter

@letter = ("A", "B", "C", "D");

$popup = PopUp(["?","A","B","C","D"], $letter[$inv[$k]]);

#Si se aplica el método reduce() al Contexto Formula, no usa estas reglas al 
#aplicar las técnicas de reducción a expresiones.
Context()->noreduce('(-x)-y','(-x)+y');

# Ecuación elegida e intercepto para ser usado en la solución. 
$ry = Formula($eqn[$k])->reduce;   #ry significa real y a ser usado
$rb = $ry->eval(x=>0);       #rb significa el real intercepto extraído al evaluar por x=0 en ry. 

Context()->texStrings;
BEGIN_TEXT
¿Cuál de las gráficas (A-D) corresponde a la recta \(y=$ry\)?
$BR
$BR
\{ $popup->menu() \}
$BR
$BR
$BCENTER
\{
  BeginTable().
  AlignedRow([$fig[0],$fig[1]]).
  TableSpace(5,0).
  AlignedRow(["A","B"]).
  TableSpace(25,6).
  AlignedRow([$fig[2],$fig[3]]).
  TableSpace(5,0).
  AlignedRow(["C","D"]).
EndTable();
\}
$BR
(Click en la gráfica para agrandar)
$ECENTER
END_TEXT
Context()->normalStrings;

install_problem_grader(~~&std_problem_grader);
$showPartialCorrectAnswers = 0;

ANS( $popup->cmp() );

Context()->texStrings;
SOLUTION(EV3(<<'END_SOLUTION'));
$BBOLD Paso 1$EBOLD: Identificar el valor de la pendiente \((m)\) y del intercepto en el eje vertical \((b)\): observables en la ecuación dada \( y = $ry\), pues \(y = mx+b\). 
$PAR 
$BBOLD Paso 2$EBOLD: Encontrar una gráfica consistente con la información anterior: la única gráfica que interseca al eje \(y\) en \((0,$rb)\) tal que el valor de \(y\) se incrementa en \($m\) cada vez que \(x\) se incrementa en 1 es $letter[$inv[$k]].
END_SOLUTION
Context()->normalStrings;

ENDDOCUMENT();