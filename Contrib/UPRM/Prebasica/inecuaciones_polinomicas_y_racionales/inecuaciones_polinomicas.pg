#  DESCRIPTION
#
#  Tipo: respuesta corta
#  Inecuaciones polinomicas: tipo x^3 + ax^2 + bx  [>,<,>=,<=] 0 
#  encontrar solución en forma de intervalo.
#  a = p + q y b = pq, con p y q enteros no cero.

#  Problema WeBWork escrito por Edwin Florez, 
#  <edwin.florez (at) upr (dot) edu>
#
#  Adaptado desde el sistema quiz.uprm.edu del archivo
#  pedro_prebasica/inecuaciones_polinomicas_y_racionales/inecuaciones_polinomicas.db
#
#  Última actualización: Edwin F. 07/30/2014
#  ENDDESCRIPTION

## DBsubject(Prebasica)
## DBchapter(Inecuaciones)
## DBsection(Polinomicas)
## Level(1)
## KEYWORDS('factorizacion','inecuaciones', 'polinomios')
##
## DBCCSS('')
## TitleText1('')
## EditionText1('')
## AuthorText1('')
## Section1('')
## Problem1('')
##
## Author(Edwin Florez)
## Institution(UPRM)
## Language(es)

##############################################

DOCUMENT();

loadMacros(
"PGstandard.pl",
"MathObjects.pl",
"PGgraphmacros.pl",
"contextInequalities.pl",
"AnswerFormatHelp.pl",
"PGchoicemacros.pl",
"contextFraction.pl",
"problemRandomize.pl",
"parserRadioButtons.pl",
"UPRMgraphMacros.pl",
"contextInequalities.pl",
"unionTables.pl"
);

TEXT(beginproblem());
$refreshCachedImages = 1;

#  Allow for the user to try another version of the problem once they get it correct.
ProblemRandomize(when=>"Correct",onlyAfterDue=>0);

# Show which answers are correct and which ones are incorrect
#$showPartialCorrectAnswers = 0;

##############################################################
#  Setup

Context("Numeric");

#creando aleatoriamente la inecuacion x^3 + ax^2 + bx  [>,<,>=,<=]  0
$p = non_zero_random(-9,9);
do{
 $q = non_zero_random(-9,9);
}until( $q != $p );

$a = $p + $q;
$b = $p*$q;

#usado para simplificar en caso que a y b sean negativos. 
$mp = -$p;
$mq = -$q;

@list_desig_tex = (">","<","\geq","\leq");
@list_desig = (">","<",">=","<=");
$index = random(0,3);

@val_cero = PGsort( sub {$_[0] < $_[1]} , (-$p,-$q,0) );

$punto_prueba1 = $val_cero[0] - 1;
$punto_prueba2 = $val_cero[1] - 0.5;
$punto_prueba3 = $val_cero[1] + 0.5;
$punto_prueba4 = $val_cero[2] + 1;

Context()->noreduce('(-x)+y', '(-x)-y');
$f = Formula("x^3 + $a x^2 + $b x")->reduce;

Context("Fraction");

$fpp1 = Fraction( $f->eval(x=>$punto_prueba1) )->reduce;
$fpp2 = Fraction( $f->eval(x=>$punto_prueba2) )->reduce;
$fpp3 = Fraction( $f->eval(x=>$punto_prueba3) )->reduce;
$fpp4 = Fraction( $f->eval(x=>$punto_prueba4) )->reduce;

Context("Inequalities");

#Subrutina que retorna un "+" o "-" si el número ingresado 
#es positivo o negativo
sub signo {
   local $a =  $_[0];
   if ( $a > 0 ) { return "\(+\)";}
   if ( $a < 0 ) { return "\(-\)";}
   if ( $a == 0 ) { return "\(0\)";}
}

#creando el intervalo solución
if ( $index == 0 ){
  $answer = Union( Compute( "($val_cero[0],$val_cero[1])" ) ,  Compute( "($val_cero[2],Inf)" ) );
  $paso_extra = "";
}elsif ($index == 1){
  $answer = Union( Compute( "(-Inf,$val_cero[0])" ) ,  Compute( "($val_cero[1],$val_cero[2])" ) );
  $paso_extra = "";
}elsif ($index == 2){
  $answer = Union( Compute( "[$val_cero[0],$val_cero[1]]" ) ,  Compute( "[$val_cero[2],Inf)" ) );
  $paso_extra = "$PAR Note que hemos añadido todos los extremos que son números, pues al sustituirlos en el polinomio obtenemos cero.";
}else{
  $answer = Union( Compute( "(-Inf,$val_cero[0]]" ) ,  Compute( "[$val_cero[1],$val_cero[2]]" ) );
  $paso_extra = "$PAR Note que hemos añadido todos los extremos que son números, pues al sustituirlos en el polinomio obtenemos cero.";
}

##############################################################
#
#  Text
#

Context()->texStrings;
BEGIN_TEXT
Hallar el conjunto solución de la siguiente inecuación
\[
 $f $list_desig_tex[$index] 0
\]
$PAR
Contestación: \{ans_rule(20)\} \{ AnswerFormatHelp("intervals") \}
END_TEXT
Context()->normalStrings;

#Context("Numeric");
##############################################################
#  Answers
#

ANS( $answer->cmp() );

Context()->texStrings;
SOLUTION(EV3(<<'END_SOLUTION'));
$BBOLD Paso 1:$EBOLD Factorizar el polinomio:
\[
$f  = x(x^2 + $a x + $b) = x(x+$p)(x+$q)
\]
$PAR
$BBOLD Paso 2:$EBOLD Hallar los valores que hacen cero a cada factor del polinomio:
\[
 \begin{align*}
  x = 0 \\
  x + $p &= 0 \quad \Rightarrow \quad x = $mp \\
  x + $q &= 0 \quad \Rightarrow \quad x = $mq,
 \end{align*}
\]
entonces los intervalos de prueba serán \( (-\infty,$val_cero[0]), ($val_cero[0],$val_cero[1]), ($val_cero[1],$val_cero[2]) \) y \( ($val_cero[2],\infty) \).
$PAR
$BBOLD Paso 2:$EBOLD Seleccionar un punto de prueba dentro de cada intervalo anterior para determinar el signo que tiene la expresión \( \displaystyle $f. \) 
$PAR
\{
 BeginTable(border=>1, tex_border=>"1pt", spacing=>0, padding=>4).
 AlignedRow( [ "$BBOLD Intervalo$EBOLD", "$BBOLD Punto de Prueba$EBOLD", "$BBOLD Evaluar$EBOLD", "$BBOLD Signo$EBOLD"], align=>CENTER, separation=>0). 
 AlignedRow( [ "\( (-\infty,$val_cero[0]) \)", "\( $punto_prueba1 \)", "\( ($punto_prueba1)^3 + $a($punto_prueba1)^2 + $b($punto_prueba1) = $fpp1 \)", signo($fpp1) ], align=>CENTER, separation=>0).
 AlignedRow( [ "\( ($val_cero[0],$val_cero[1]) \)", "\( $punto_prueba2 \)", "\( ($punto_prueba2)^3 + $a($punto_prueba2)^2 + $b($punto_prueba2)  = $fpp2 \)", signo($fpp2) ], align=>CENTER, separation=>0).
 AlignedRow( [ "\( ($val_cero[1],$val_cero[2]) \)", "\( $punto_prueba3 \)", "\( ($punto_prueba3)^3 + $a($punto_prueba3)^2 + $b($punto_prueba3)   = $fpp3 \)", signo($fpp3) ], align=>CENTER, separation=>0).
 AlignedRow( [ "\( ($val_cero[2],\infty)  \)", "\( $punto_prueba4 \)", "\( ($punto_prueba4)^3 + $a($punto_prueba4)^2 + $b($punto_prueba4)   = $fpp4 \)", signo($fpp4) ], align=>CENTER, separation=>0).
EndTable()
\}
$PAR
Buscamos los valores de \(x\) que hagan el polinomio \($list_desig_tex[$index] 0\). Basándonos en la tabla anterior, el conjunto solución es: \($answer\).
$paso_extra
END_SOLUTION
Context()->normalStrings;

ENDDOCUMENT();