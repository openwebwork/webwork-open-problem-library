## DESCRIPTION
## Generates ML lists and asks for values returned after using map and reduce functions.
## ENDDESCRIPTION

## DBsubject(Programming Languages)
## DBchapter(ML)
## DBsection(Functions)
## Date(12/5/2025)
## Institution(Louisiana Tech)
## Author(Jason Terry)
## Level(2)
## KEYWORDS('programming languages','ml','sml','function','type','map','reduce','fold')


DOCUMENT();

## Load libraries
loadMacros(
"PGstandard.pl",
"PGcourse.pl",
"contextArbitraryString.pl",
"PGML.pl"
);

## Change context to strings answers
Context("ArbitraryString");

## Create custom answer checker for ML types
$typeChecker = sub {
        my ($correct,$student,$ansHash) = @_;  # get correct and student MathObjects
        $correct = $correct->string;
        $student = $student->string;
        $student =~ s/^ *(.*?) *$/$1/;     # remove front/end whitespace
        $student =~ s/ *~~* */~~*/g;       # * shall have no space on each side
        $student =~ s/ *- */-/g;           # - shall have no space on each side
        $student =~ s/ *> */>/g;           # > shall have no space on each side
        $student =~ s/ *' */'/g;           # ' shall have no space on each side        
        $student =~ s/~~( */~~(/g;         # ( shall have no space after
        $student =~ s/ *~~)/~~)/g;         # ) shall have no space before
        $student =~ s/ *list/ list/g;      # list shall have 1 space before
        return ($correct eq $student);     # return 1 if correct, 0 otherwise
    };

## Create custom answer checker for ML values
$valChecker = sub {
        my ($correct,$student,$ansHash) = @_;  # get correct and student MathObjects
        $correct = $correct->string;
        $student = $student->string;
        $student =~ tr/ //ds;               # strip all whitespace
        return ($correct eq $student);      # return 1 if correct, 0 otherwise
    };

## Create random parameters
$a = random(1,3,1);
$b = random(4,6,1);
$c = random(7,9,1);
$d = random(10,13,1);
$n = random(3,9,1);

## Create value answers to problems and install custom value checker
$apn = $a + $n;
$bpn = $b + $n;
$cpn = $c + $n;
$dpn = $d + $n;
$ama = $a - $a;
$bma = $b - $a;
$cma = $c - $a;
$dma = $d - $a;
$apb = $a + $b;
$cpd = $c + $d;

$ans1 = String("[]")->cmp(
        checker => $valChecker
    );
$ans2 = String("[$apn,$bpn,$cpn,$dpn]")->cmp(
        checker => $valChecker
    );
$ans3 = String("[$apb,$cpd]")->cmp(
        checker => $valChecker
    );
$ans4 = String("[($apn,$ama),($bpn,$bma),($cpn,$cma),($dpn,$dma)]")->cmp(
        checker => $valChecker
    );
$ans5 = $n + $a + $b + $c + $d;

## Create type answers to problems and install custom type checker
$type1 = String("int list")->cmp(
        checker => $typeChecker
    );

$type2 = String("int list")->cmp(
        checker => $typeChecker
    );

$type3 = String("int list")->cmp(
        checker => $typeChecker
    );

$type4 = String("(int*int) list")->cmp(
        checker => $typeChecker
    );

$type5 = String("int")->cmp(
        checker => $typeChecker
    );


## Display question
TEXT(beginproblem());

BEGIN_PGML
Suppose we execute the following lines of ML code.

    *fun f x = x + [$n];*

    *fun g (a,b) = a + b;*

    *fun h x = (x + [$n], x - [$a]);*

Write the value and type of the following ML expressions. *WARNING: Types must use the minimum set of parentheses to match the ML compiler's response.*

    *map f \[\];*

    *val it = [_________________________]{$ans1} : [_________________________]{$type1}*
===
    *map f \[[$a],[$b],[$c],[$d]\];*

    *val it = [_________________________]{$ans2} : [_________________________]{$type2}*
===
    *map g \[([$a],[$b]),([$c],[$d])\];*

    *val it = [_________________________]{$ans3} : [_________________________]{$type3}*
===
    *map h \[[$a],[$b],[$c],[$d]\];*

    *val it = [_________________________]{$ans4} : [_________________________]{$type4}*
===
    *foldl g [$n] \[[$a],[$b],[$c],[$d]\];*

    *val it = [_________________________]{$ans5} : [_________________________]{$type5}*


END_PGML

BEGIN_PGML_SOLUTION
Solution:

    *map f \[\];*

    *val it = \[\] : int list*
===
    *map f \[[$a],[$b],[$c],[$d]\];*

    *val it = \[[$apn],[$bpn],[$cpn],[$dpn]\] : int list*
===
    *map g \[([$a],[$b]),([$c],[$d])\];*

    *val it = \[[$apb],[$cpd]\] : int list*
===
    *map h \[[$a],[$b],[$c],[$d]\];*

    *val it = \[([$apn],[$ama]),([$bpn],[$bma]),([$cpn],[$cma]),([$dpn],[$dma])\] : (int \* int) list*
===
    *foldl g [$n] \[[$a],[$b],[$c],[$d]\];*

    *val it = [$ans5] : int*


END_PGML_SOLUTION

ENDDOCUMENT();
