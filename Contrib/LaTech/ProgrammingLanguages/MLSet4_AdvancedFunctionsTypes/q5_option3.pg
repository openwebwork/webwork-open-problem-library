## DESCRIPTION
## Generates functions in ML using options and asks for their type.
## ENDDESCRIPTION

## DBsubject(Programming Languages)
## DBchapter(ML)
## DBsection(Functions)
## Date(12/05/2025)
## Institution(Louisiana Tech)
## Author(Jason Terry)
## Level(2)
## KEYWORDS('programming languages','ml','sml','function','type','option')


DOCUMENT();

## Load libraries
loadMacros(
"PGstandard.pl",
"PGcourse.pl",
"contextArbitraryString.pl",
"PGML.pl"
);

## Change context to strings answers
Context("ArbitraryString");

## Create custom answer checker for ML types
$typeChecker = sub {
        my ($correct,$student,$ansHash) = @_;  # get correct and student MathObjects
        $correct = $correct->string;
        $student = $student->string;
        $student =~ s/^ *(.*?) *$/$1/;     # remove front/end whitespace
        $student =~ s/ *~~* */~~*/g;       # * shall have no space on each side
        $student =~ s/ *- */-/g;           # - shall have no space on each side
        $student =~ s/ *> */>/g;           # > shall have no space on each side
        $student =~ s/ *' */'/g;           # ' shall have no space on each side        
        $student =~ s/~~( */~~(/g;         # ( shall have no space after
        $student =~ s/ *~~)/~~)/g;         # ) shall have no space before
        $student =~ s/ *list/ list/g;      # list shall have 1 space before
        $student =~ s/ *option/ option/g;  # option shall have 1 space before
        return ($correct eq $student);     # return 1 if correct, 0 otherwise
    };

## Create custom answer checker for ML values
$valChecker = sub {
        my ($correct,$student,$ansHash) = @_;  # get correct and student MathObjects
        $correct = $correct->string;
        $student = $student->string;
        $student =~ tr/ //ds;               # strip all whitespace
        return ($correct eq $student);      # return 1 if correct, 0 otherwise
    };

$n = random(2,9,1);

## Create type answers to problems and install custom type checker
$type1 = String("'a*'b->'a option*int")->cmp(
        checker => $typeChecker
    );

$type2 = String("'a*'b->('a*int) option")->cmp(
        checker => $typeChecker
    );

$type3 = String("'a*'b->'a option*int option")->cmp(
        checker => $typeChecker
    );

$type4 = String("'a->'a option*'a")->cmp(
        checker => $typeChecker
    );

$type5 = String("'a option*'a->'a option list")->cmp(
        checker => $typeChecker
    );


## Display question
TEXT(beginproblem());

BEGIN_PGML
Write the type of the given ML function f. *WARNING: Types must use the minimum set of parentheses to match the ML compiler's response.*

    *fun f (x,y) = (SOME x, [$n]);*

    *val it = fn : [_________________________]{$type1}*
===
    *fun f (x,y) = SOME (x, [$n]);*

    *val it = fn : [_________________________]{$type2}*
===
    *fun f (x,y) = (SOME x, SOME [$n]);*

    *val it = fn : [_________________________]{$type3}*
===
    *fun f x = (SOME x, x);*

    *val it = fn : [_________________________]{$type4}*
===
    *fun f (x,y) = \[SOME y, x\];*

    *val it = fn : [_________________________]{$type5}*


END_PGML


BEGIN_PGML_SOLUTION
Solution:

    *fun f (x,y) = (SOME x, [$n]);*

    *val it = fn : 'a \* 'b -> 'a option \* int*
===
    *fun f (x,y) = SOME (x, [$n]);*

    *val it = fn : 'a \* 'b -> ('a \* 'b) option*
===
    *fun f (x,y) = (SOME x, SOME [$n]);*

    *val it = fn : 'a \* 'b -> 'a option \* int option*
===
    *fun f x = (SOME x, x);*

    *val it = fn : 'a -> 'a option \* 'a*
===
    *fun f (x,y) = \[SOME y, x\];*

    *val it = fn : 'a option \* 'a -> 'a option list*



END_PGML_SOLUTION

ENDDOCUMENT();
