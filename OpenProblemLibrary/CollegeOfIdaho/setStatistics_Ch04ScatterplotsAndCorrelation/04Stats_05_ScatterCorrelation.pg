## DBsubject(Statistics)
## DBchapter(Simple linear regression)
## DBsection(Correlation)
## Institution(The College of Idaho)
## Author(R Cruz, L Danielson, J Guild)
## MLT(CalculateRFromData)
## Level(1)
## MO(1)
## TitleText1('The Basic Practice of Statistics')
## AuthorText1('David Moore')
## EditionText1('5e')
## Section1('4')
## Problem1('')
## KEYWORDS('statistic', 'correlation')

DOCUMENT();

loadMacros(
    'PGstandard.pl',         'PGML.pl',
    'PGstatisticsmacros.pl', 'answerHints.pl',
    'parserPopUp.pl',        'PGcourse.pl'
);

Context('Numeric');

$showPartialCorrectAnswers = 0;

#  Setup

@x = (
    random(50,   100,  25),
    random(50,   100,  25),
    random(75,   150,  25),
    random(150,  300,  50),
    random(200,  300,  50),
    random(300,  600,  100),
    random(600,  900,  100),
    random(1000, 1400, 100),
    random(1400, 1800, 100),
    random(2000, 4000, 100)
);

@y = (
    random(5,   8,   .1),
    random(7,   7.5, .1),
    random(10,  15,  .1),
    random(20,  30,  .1),
    random(40,  50,  .1),
    random(90,  100, .1),
    random(130, 150, .1),
    random(180, 200, .1),
    random(200, 240, .1),
    random(220, 240, .1)
);

$r = Compute(sample_correlation(~~@x, ~~@y))
    ->with(tolType => 'absolute', tolerance => '0.005');
$cmp = $r->cmp->withPostFilter(AnswerHints(
    sub {
        my ($correct, $student, $anshash) = @_;
        return abs($student - $correct) < .02;
    } => ["Close!  Try the calculation using more accuracy."]
));

$redo = DropDown([ 'Yes', 'No' ], $r > 0.997 ? 1 : 0);

BEGIN_PGML
Keeping water supplies clean requires regular measurement of levels of pollutants. The measurements are indirect- a typical analysis involves forming a dye by a chemical reaction with the dissolved pollutant, then passing light through the solution and measuring its _absorbence_. To calibrate such measurements, the laboratory measures known standard solutions and uses regression to relate absorbence and pollutant concentration. This is usually done every day. Here is one series of data on the absorbence for different levels of nitrates. Nitrates are measured in milligrams per liter of water.

[#
    [. **Nitrates**.] [. [$x[0]] .][. [$x[1]] .][. [$x[2]] .][. [$x[3]] .]
    [. [$x[4]] .][. [$x[5]] .][. [$x[6]] .][. [$x[7]] .][. [$x[8]] .][. [$x[9]] .]*
    [. **Absorbance**.] [. [$y[0]] .][. [$y[1]] .][. [$y[2]] .][. [$y[3]] .]
    [. [$y[4]] .][. [$y[5]] .][. [$y[6]] .][. [$y[7]] .][. [$y[8]] .][. [$y[9]] .]*
#]{horizontalrules=>1,align=>'|c|c|c|c|c|c|c|c|c|c|c|'}

Chemical theory says that these data should lie on a straight line. If the correlation is not at least 0.997, something went wrong and the calibration procedure is repeated.

a) Find the correlation [` r `].

    [` r `] =  [_]{$cmp}

b) Must the calibration be done again? [_]{$redo}

END_PGML

$soln =
    $r > 0.997
    ? 'Since \(r\) is greater than 0.997, there is no need to redo the calibration. '
    : 'Since \( r\) is less than 0.997, the calibration needs to be done again.';

BEGIN_PGML_SOLUTION
a) Use some software to determine the correlation coefficient.  In this case, [`r=[$r]`].

b) [$soln]*
END_PGML_SOLUTION

ENDDOCUMENT(); # This should be the last executable line in the problem.