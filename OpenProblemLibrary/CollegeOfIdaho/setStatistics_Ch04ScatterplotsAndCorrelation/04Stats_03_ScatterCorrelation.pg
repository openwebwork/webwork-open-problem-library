## DESCRIPTION
##  Find the correlation coefficient of a dataset and answer a question about
##  correlation.
## ENDDESCRIPTIOIN
## DBsubject(Statistics)
## DBchapter(Simple linear regression)
## DBsection(Correlation)
## Institution(Rochester)
## Author(R Cruz, L Danielson, J Guild)
## MLT(CalculateRFromData)
## Level(3)
## MO(1)
## TitleText1('The Basic Practice of Statistics')
## AuthorText1('David Moore')
## EditionText1('5e')
## Section1('4')
## Problem1('')
## KEYWORDS('statistic', 'correlation', 'scatterplots','Correlation', 'Coefficient')

DOCUMENT();

loadMacros(
    'PGstandard.pl',         'PGML.pl',
    'PGstatisticsmacros.pl', 'answerHints.pl',
    'parserRadioButtons.pl', 'PGtikz.pl',
    'PGcourse.pl'
);

#  Setup

$gen = random(0, 5);

@ans = (
    "a positive correlation between \(x\) and \(y\)",
    "a perfect positive correlation between \(x\) and \(y\)",
    "a negative correlation between \(x\) and \(y\)",
    "a perfect negative correlation between \(x\) and \(y\)",
    "no correlation between \(x\) and \(y\)",
    "a nonlinear correlation between \(x\) and \(y\)"
);

for $i (0 .. 14) {
    $x[$i] = random($i, $i + 0.9, 0.1);
    $y[$i] =
        $gen == 0   ? $x[$i] + 2 * sin(20 * $x[$i])
        : $gen == 1 ? $x[$i]
        : $gen == 2 ? 15 - $x[$i] - 2 * sin(20 * $x[$i])
        : $gen == 3 ? 15 - $x[$i]
        : $gen == 4 ? random(0, 15, 0.1)
        :             15 / 7.5**2 * ($x[$i] - 7.5)**2;

    $y[$i] = int($y[$i] * 10 + 0.5) / 10;
}

$r = Real(sample_correlation(~~@x, ~~@y))
    ->with(tolType => 'absolute', tolerance => '0.005');
$cmp = $r->cmp->withPostFilter(AnswerHints(
    sub {
        my ($correct, $student, $anshash) = @_;
        return abs($student - $correct) < .02;
    } => ["Close!  Try the calculation using more accuracy."]
));

$radio = RadioButtons(~~@ans, $gen, labels => "ABC");

BEGIN_PGML
Use a scatterplot and the linear correlation coefficient [` r `] to determine whether 
there is a correlation between the two variables. (Note: Use software, and don't forget to look at the scatterplot!)

[# 
    [. [`x`] .] [. [$x[0]] .][. [$x[1]] .][. [$x[2]] .][. [$x[3]] .][. [$x[4]] .]
    [. [$x[5]] .][. [$x[6]] .][. [$x[7]] .][. [$x[8]] .][. [$x[9]] .][. [$x[10]] .]
    [. [$x[11]] .][. [$x[12]] .][. [$x[13]] .][. [$x[14]] .]*
    [. [`y`] .] [. [$y[0]] .][. [$y[1]] .][. [$y[2]] .][. [$y[3]] .][. [$y[4]] .]
    [. [$y[5]] .][. [$y[6]] .][. [$y[7]] .][. [$y[8]] .][. [$y[9]] .][. [$y[10]] .]
    [. [$y[11]] .][. [$y[12]] .][. [$y[13]] .][. [$y[14]] .]*
#]


a) [` r= `] [_]{$cmp}

b)  There is 

    [_]{$radio}
END_PGML

# Generate the tikz code for the points.
$str = '';
for $i (0 .. 14) {
    $str .= "\fill($x[$i],$y[$i]) circle[radius=2pt];\n";
}

$graph = createTikZImage();
$graph->tikzLibraries('arrows.meta');
$graph->BEGIN_TIKZ
\tikzset{>={Stealth[scale = 1.5]}}
\filldraw[
    draw = LightBlue,
    fill = white,
    rounded corners = 10pt,
    thick,
    use as bounding box
] (-1, -1) rectangle (16, 16);
\draw[->, thick] (-1, 0) -- (15.5, 0) node [above right] {\(x\)};

\foreach \x in {3,6,...,15}
    \draw(\x,0.25)--(\x,-0.25) node [below] {\(\x\)};
\draw[->, thick] (0, -1) -- (0, 15.5) node [above right] {\(y\)};
\foreach \y in {3,6,...,15}
    \draw (5pt, \y) -- (-5pt, \y) node[left] {\(\y\)};

$str

END_TIKZ

$alt_text = "A scatter plot of the data shown above.";

BEGIN_PGML_SOLUTION
First, the scatter plot of the data is 
>>[! [$alt_text] !]{$graph}{400}<<

And using some software, determine that [`r=[$r]`].  Therefore the correct response for b) is [$radio].
END_PGML_SOLUTION

ENDDOCUMENT();       # This should be the last executable line in the problem.