## BEGIN_DESCRIPTION
## Using the Sage single cell server, determine the average value of a "ugly"
## function where the student must only determine the correct order and limits of integration
## END_DESCRIPTION

## KEYWORDS('sage', 'sagelet', 'integration', 'multiple','average')

## DBsubject('Calculus - multivariable')
## DBchapter('Multiple Integrals')
## DBsection('Applications of Multiple Integrals')
## Date('March 2012')
## Author('John Travis')
## Institution('Mississippi College')
## TitleText1('Calculus')
## EditionText1('')
## AuthorText1('')
## Section1('')
## Problem1('')

DOCUMENT();

loadMacros(
"PGstandard.pl",
"PGchoicemacros.pl",
"MathObjects.pl",
"problemRandomize.pl",
);

Context()->strings->add(none=>{});
Context()->variables->add(y=>"Real",z=>"Real");

TEXT(beginproblem());

ProblemRandomize(when=>"Correct",onlyAfterDue=>0);

$r1 = random(20,30,1);
$r2 = random(2,4,0.1);

$fin = "$r1-x**2/$r2-y**2";
$funct  = Compute($fin);

$x0 = -1; 
$x1 = 4;
$y0 = 2;
$y1 = 3;

$height = ((4/3)*((3*$r1 - 19)*$r2 - 16)/$r2 + (1/3)*((3*$r1 - 19)*$r2 -
1)/$r2)/(($x1-$x0)*($y1-$y0));
$volume = $height *($x1-$x0)*($y1-$y0);

$showHint = 3;

TEXT(MODES(TeX =>"",HTML=>EV3(<<'EOT')));

$PAR
The average value of a function \(f(x_0,y_0)\) over a given region \(R\) is given by taking the volume of the resulting solid and dividing by the area over which the volume is defined.  In notation, \[ f(x_0,y_0) = \frac{\int \int _{R} f(x,y)dA}{\int \int _{R} dA} \]
Geometrically, this occurs when the volume of the solid equals the volume of one box...
\[ V = \int \int _{R} f(x,y)dA = f(x_0,y_0) \int \int _{R} dA = height \times base\]


Adjust values of \(f(x_0,y_0)\) above to determine the correct
$BITALICSaverage height 
$EITALICS
so that the volume of the region under the surface equals the volume of the single rectangular box.  The height of this box will be the average value of \(f\). 

$PAR

$PAR
EOT

############### start Sage Cell ###############
BEGIN_TEXT

<div id="sagecell">

height = \{ ans_rule(15) \} 

<script type="text/code">
 
# Sage Python Code

var('x,y')
xmin = $x0
xmax = $x1
xmid = (xmin+xmax)/2
xdiff= xmax-xmin
ymin = $y0
ymax = $y1
ymid = (ymin+ymax)/2
ydiff= ymax-ymin
zmax = $r1

f(x,y) = $funct

~~@interact(layout=dict(bottom=[["z0"],["nojavagraph"]]))
def _(z0 = slider(1,zmax,label='f(x_0,y_0)'),
    nojavagraph=checkbox(default=false,label='Problems with 3D Graph?')):
    
    if nojavagraph:
        view_method = "tachyon"
    else:
        view_method = "jmol"

    integ = integrate(integrate(f,y,ymin,ymax),x,xmin,xmax).n()
    box_vol =(xmax-xmin)*(ymax-ymin)*z0    

    B = bar_chart([integ,0,box_vol],axes=false,width=1,color='gray')
    B += text('Exact Vol.->',(1,integ+2),horizontal_alignment='center',color='blue')
    B += text('<-Box Vol.',(2,box_vol+2),horizontal_alignment='left',color='green')
    B.show(figsize=(2,5))
    
    G = plot3d(f, (x, xmin, xmax), (y,ymin,ymax),opacity=0.3)
    G += plot3d(z0, (x, xmin, xmax), (y,ymin,ymax),color='green',opacity=0.6)
    G += cube(color=['green', 'green', 'green'],aspect_ratio=[1,1,1], center=(xmid/xdiff, ymid/ydiff,1/2) ,opacity=0.3).scale([xdiff,ydiff,z0])
            
    G.show(figsize=(4,6),viewer=view_method)

    html('<input type=hidden size=15 name="\{ANS_NUM_TO_NAME(1)\}" id="\{ANS_NUM_TO_NAME(1)\}" value="%s">' %str(z0) )

 </script>
 </div>

END_TEXT


TEXT(MODES(TeX=>"", HTML=><<'SAGE_SCRIPT'));

<script src="http://aleph.sagemath.org/static/jquery.min.js"></script>
<script src="http://aleph.sagemath.org/embedded_sagecell.js"></script>

<script>
$(function () {
   sagecell.makeSagecell({inputLocation:  '#sagecell',
                          template:       sagecell.templates.minimal,
                          autoeval:        true, 
                          evalButtonText: 'Start/Restart'});
});
</script>


SAGE_SCRIPT

Context()->normalStrings;

ANS( Compute($height)->with(tolerance=>0.0075)->cmp() );

BEGIN_HINT
$BR
The volume of the region under the given surface is fixed and given by the length of the blue bar.  The volume of the single box is length x width x height where the height is adjustable using the slider.  Adjust the slider so that the two volumes are as close as possible.
$PAR

END_HINT

BEGIN_SOLUTION
$PAR
$BBOLD SOLUTION $EBOLD
$BR
The actual region's volume is given by 
$volume = $height*($x1-$x0)*($y1-$y0).

So, the desired height is $height.

END_SOLUTION

ENDDOCUMENT();        # This should be the last executable line in the problem.
