## DESCRIPTION
##   Correlation Coefficient
## ENDDESCRIPTION

## Tagged by nhamblet

## DBsubject(Statistics)
## DBchapter(Simple linear regression)
## DBsection(Correlation)
## Institution(Rochester)
## MLT(CalculateRFromData)
## Level(3)
## KEYWORDS('Correlation', 'Coefficient')

## Updated 2025.02 by Peter Staab, switch to PGML and added a solution.

DOCUMENT();    # This should be the first executable line in the problem.

loadMacros('PGstandard.pl', 'PGML.pl', 'PGstatisticsmacros.pl', 'PGcourse.pl');

Context('Numeric');

for $i (0 .. 7) {
    $x[$i] = random(-2, 4, 1);
    $y[$i] = random( 0, 6, 1);
    $table->[$i] = [$x[$i], $y[$i]];
}

$r = sample_correlation(~~@x, ~~@y);

BEGIN_PGML
Given the following data set,

[# [. [`x`] .] [. [`y`] .]*{headerrow => 1}
   [. .]{rows => $table}
#]

Compute the coefficient of correlation.

[`r = `] [_]{Real([$r])}{20} 
END_PGML

($sumx, $sumy, $sumxy, $sumxsq, $sumyssq) = (0, 0, 0, 0, 0);
for $i (0 .. 7) {
    $sumx   += $x[$i];
    $sumy   += $y[$i];
    $sumxy  += $x[$i] * $y[$i];
    $sumxsq += $x[$i]**2;
    $sumysq += $y[$i]**2;
    $data->[$i] = [ '', $x[$i], $y[$i], $x[$i] * $y[$i], $x[$i]**2, $y[$i]**2 ];
}
BEGIN_PGML_SOLUTION
This dataset is small enough to do by hand with a table.  Create the following table with 

[# [. .][.[`x`].][.[`y`].][. [`xy`] .] [.[`x^2`].] [. [`y^2`] .]*{headerrow => 1}
   [. .]*{rows => $data}
   [. .]*{rowbottom => 1}
   [. Sum .] [. [$sumx] .] [.[$sumy].][.[$sumxy].] [.[$sumxsq].] [.[$sumysq].]
#]

Next, we use the formula for correlation (there are a number of equivalent formulas.)

[``` 
\begin{aligned}
r & = \frac{ n \sum x_i y_i - \sum x_i \sum y_i}
{\sqrt{n \sum x_i^2 - (\sum x_i)^2}\sqrt{n \sum y_i^2 - (\sum y_i)^2}}  \\
& = \frac{8 ([$sumxy]) - ([$sumx])([$sumy])}
{\sqrt{8 ([$sumxsq]) - ([$sumx])^2}\sqrt{8 ([$sumysq]) - ([$sumy])^2}} =
[$r]
\end{aligned}
```]
END_PGML_SOLUTION

ENDDOCUMENT();       # This should be the last executable line in the problem.