##DESCRIPTION
##   Statistics: Regression
##ENDDESCRIPTION

##Tagged by up2p

## DBsubject(Statistics)
## DBchapter(Simple linear regression)
## DBsection(Correlation)
## Institution(ASU)
## MLT(CalculateRFromData)
## MLTleader(1)
## Level(2)
## KEYWORDS('Statistics')

DOCUMENT();

loadMacros('PGstandard.pl', 'PGML.pl', 'PGstatisticsmacros.pl', 'PGcourse.pl');

for $i (0 .. 4) {
    $x[$i]            = random(3,  17, 1);
    $y[$i]            = random(15, 31, 1);
    $table_data->[$i] = [ $i + 1, $x[$i], $y[$i] ];
}

$cor = sample_correlation(~~@x, ~~@y);

BEGIN_PGML
Consider the following small data set.

[# [. Subject.] [.[`x`] .] [. [`y`] .]*{headerrow => 1}
    [. .]{rows => $table_data}
#]

Find the linear correlation coefficient.

[`r = `] [_]{Real($cor)}

END_PGML

($sumx, $sumy, $sumxy, $sumxsq, $sumysq) = (0, 0, 0, 0, 0);
for $i (0 .. 4) {
    $xsq[$i] = $x[$i]**2;
    $ysq[$i] = $y[$i]**2;
    $xy[$i]  = $x[$i] * $y[$i];
    $sumx   += $x[$i];
    $sumy   += $y[$i];
    $sumxy  += $xy[$i];
    $sumxsq += $xsq[$i];
    $sumysq += $ysq[$i];
    $table->[$i] = [ $i + 1, $x[$i], $y[$i], $xy[$i], $xsq[$i], $ysq[$i] ];
}

BEGIN_PGML_SOLUTION
We build a table with [`x^2`], [` y^2`] and [`xy`] and then the sums: 

[#
    [.Subject.][. [`x`] .] [. [`y`] .] [. [`xy`] .] [. [`x^2`] .] [. [`y^2`].]*{headerrow => 1}
    [. .]*{rows => $table}
    [. .]*{rowbottom => 1}
    [. Sum .] [.[$sumx].] [.[$sumy].] [.[$sumxy].] [.[$sumxsq].] [.[$sumysq].]
#]

Now, we use the formula for the correlation coefficient (note there are many forms of this)
[```
\begin{aligned}
r & = \frac{n \sum x_i y_i - \sum x_i \sum y_i}{
\sqrt{n \sum x_i^2 -(\sum x_i)^2}\sqrt{n \sum y_i^2 - (\sum y_i)^2}} \\
& = \frac{5 ([$sumxy]) - ([$sumx])([$sumy])}
{\sqrt{5([$sumxsq])-([$sumx])^2}\sqrt{5([$sumysq]) -([$sumy])^2}} \\
& = [$cor]
\end{aligned}
```]
END_PGML_SOLUTION


ENDDOCUMENT();        # This should be the last executable line in the problem.